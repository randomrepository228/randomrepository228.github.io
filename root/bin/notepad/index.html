<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../../sys/windows.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <link rel="stylesheet" href="../../res/aero/style.css" id="theme">
        <meta name="viewport" content="width=device-width, initial-scale=0.6, user-scalable=no">
        <style>
            body {
                overflow: auto; 
            }
            textarea, textarea:hover{
                min-width: 100%;
                min-height: 100%;
                outline: none;
                border: none;
                color: black;
                background-color: white;
                font-size: 15px;
                line-height: 100%;
                padding: 0;
                resize: none;
            }
        </style>
        <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
        <script>
            function changeTheme(a){
                theme.href = "../../res/" + a + "/style.css"
            }
            changeTheme(localStorage.theme)
            onmessage = (e) => {
                const commands = e.data.split("|")
                if (commands[0] == "theme" && commands.length == 2)
                    changeTheme(commands[1])
            }
            const args = frameElement.getAttribute("args")
        </script>
    </head>
    <body>
        <div class="menubar">
            <div class="element" onmousedown="
                const rect = this.getBoundingClientRect(); 
                const frameRect = frameElement.getBoundingClientRect(); parent.contextMenu(event, [
            ['', 'Save', async () => {if (await parent.fs.writeFile(args, new Blob([textarea.value]))) parent.msgbox('error', 'Cannot write to a file')}], 
            // ['', 'Save as', async () => {if (await parent.fs.writeFile(args, new Blob([textarea.value]))) parent.msgbox('error', 'Cannot write to a file')}]
        ], rect.x + frameRect.x, rect.y + rect.height + frameRect.y)">File</div>
        </div>
        <textarea name="textarea" id="textarea" spellcheck="false" wrap="off" onmousedown="parent.contextMenuOff()"></textarea>
        <script>
            if(args) (async () => {
                const filecontent = (await parent.fs.readFile(args))
                if (typeof filecontent == "string") textarea.value = filecontent
                else {
                    try{
                        textarea.value = await filecontent.text()
                    }
                    catch(e){
                        textarea.value = new TextDecoder().decode(filecontent)
                    }
                }
            })()
            let thisWindow = frameElement.parentElement.parentElement.parentElement
            parent.showWindow("./bin/notepad/icon.png", thisWindow.getAttribute("windowid"));
        </script>
    </body>
</html>