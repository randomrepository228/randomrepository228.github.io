<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../../Winda/Resources/aero/style.css">
        <link rel="stylesheet" href="../../Winda/fonts/fonts.css">
        <link rel="stylesheet" href="../../Winda/dwm.css">
        <meta name="viewport" content="width=device-width, initial-scale=0.6, user-scalable=no">
        <style>
            html { 
                overflow: auto; 
            } 
            body {
                overflow: none; 
            }
            .main{
                border: 1px solid black;
                margin: 15px;
                background-color: white;
                overflow: auto;
                cursor: default;
                height: calc(100% - 90px);
            }
            table{
                table-layout: fixed;
                min-width: 100%;
            }
            th{
                resize: horizontal;
                text-align: left;
                font-weight: 300;
            }
            td{
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            tr:last-child{
                width: fit-content;
            }
            .buttons{
                display: flex;
                justify-content: space-between;
                width: 100%;
                margin-top: -10px;
            }
            button{
                margin-right: 15px;
            }
            tr:hover{
                background-color: rgba(0, 174, 255, 0.5);
            }
            tr[selected]{
                background-color: rgba(0, 174, 255, 0.7);
            }
        </style>
        <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
    </head>
    <body>
        <div class="menubar">
            <div class="element">File</div>
        </div>
        <div class="main"> 
            <table>
                <tr>
                    <th>Name</th>
                    <th width="50px">PID</th>
                </tr>
                <tbody id="table"></tbody>
            </table>
        </div>
        <div class="buttons">
            <div></div>
            <button onclick="top.AddWindow(new Window((window.innerWidth/2)-125, (window.innerHeight/2)-75, 250, 150, 'End Task', `${editvalue}`, ''), false, true, true, true)" disabled>
                End process
            </button>
        </div>
        <div class="details">
            <div class="detail" id="processes"></div>
        </div>
        <script>
            class Window {
                constructor(x, y, width, height, title, innerhtml, icon) {
                    this.height = height;
                    this.width = width;
                    this.x = x;
                    this.y = y;
                    this.title = title;
                    this.innerhtml = innerhtml;
                    this.icon = icon
                }
            }
            function refresh(){
                let temptable = "";
                const allWindows = top.getAllWindows()
                for (let i = 0; i < allWindows.length; i++){
                    let col = document.createElement("tr")
                    entryInfo = [allWindows[i].title, allWindows[i].id]
                    for(const info of entryInfo){
                        let row = document.createElement("td")
                        row.innerHTML = info
                        const editvalue = `
<div>
    <div style="margin: 10px">End task "${allWindows[i].title}" with PID ${allWindows[i].id}?</div><br>
</div>
<footer>
    <button onclick="closeWindow(idToWindow(${allWindows[i].id}))">Yes</button>
</footer>`
                        // col.setAttribute("onclick",)
                        col.appendChild(row)
                    }
                    temptable += col.outerHTML;
                }
                if (temptable !== table.innerHTML){
                    processes.innerText = "Processes: " + allWindows.length
                    table.innerHTML = temptable
                }
            }
            refresh()
            setInterval(refresh, 1000)
            top.showWindow("../ProgramFiles/taskmgr/icon.png", frameElement.parentElement.parentElement.parentElement.getAttribute("windowid"));
        </script>
    </body>
</html>